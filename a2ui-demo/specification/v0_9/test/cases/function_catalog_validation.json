{
  "schema": "server_to_client.json",
  "tests": [
    {
      "description": "required: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "required",
                    "args": { "value": { "path": "/val" } },
                    "returnType": "boolean"
                  },
                  "message": "Required"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "required: Invalid args (empty)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "required", "args": {} }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "required: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "required", "args": {"value": {"path": "/val"}}, "returnType": "string" }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "regex: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "regex",
                    "args": { "value": { "path": "/val" }, "pattern": "^abc$" }
                  },
                  "message": "Match"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "regex: Invalid args (missing pattern)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "regex", "args": { "value": { "path": "/val" } } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "length: Valid min",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "length", "args": { "value": { "path": "/val" }, "min": 5 } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "length: Valid max",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "length", "args": { "value": { "path": "/val" }, "max": 10 } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "length: Invalid constraint (empty object)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "length", "args": { "value": { "path": "/val" } } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "numeric: Valid range",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "numeric", "args": { "value": { "path": "/val" }, "min": 0, "max": 100 } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "email: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "email", "args": { "value": { "path": "/val" } } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "formatString: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatString",
                "args": { "value": "Hello ${/name}" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatString: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatString",
                "args": { "value": "Hi" },
                "returnType": "boolean"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatNumber: Valid args",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatNumber",
                "args": { "value": 1234.567, "decimals": 2, "grouping": true },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatNumber: Invalid args (wrong type for precision)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatNumber",
                "args": { "value": 1234.567, "decimals": "2" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatCurrency: Valid args",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatCurrency",
                "args": { "value": 99.99, "currency": "USD" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatCurrency: Missing currency code",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatCurrency",
                "args": { "value": 99.99 },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatDate: Valid args",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatDate",
                "args": { "value": "2023-01-01", "format": "MMM d" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "pluralize: Valid args",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "pluralize",
                "args": { "value": 5, "one": "item", "other": "items" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "pluralize: Invalid (missing 'other')",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "pluralize",
                "args": { "value": 5, "one": "item" },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "openUrl: Valid call in Action",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "btn1",
              "component": "Button",
              "child": "txt1",
              "action": {
                "functionCall": {
                  "call": "openUrl",
                  "args": { "url": "https://example.com" },
                  "returnType": "void"
                }
              }
            },
            { "id": "txt1", "component": "Text", "text": "Go" }
          ]
        }
      }
    },
    {
      "description": "openUrl: Invalid args (string instead of object)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "btn1",
              "component": "Button",
              "child": "txt1",
              "action": {
                "functionCall": {
                  "call": "openUrl",
                  "args": "https://example.com",
                  "returnType": "void"
                }
              }
            },
            { "id": "txt1", "component": "Text", "text": "Go" }
          ]
        }
      }
    },
    {
      "description": "openUrl: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "btn1",
              "component": "Button",
              "child": "txt1",
              "action": {
                "functionCall": {
                  "call": "openUrl",
                  "args": { "url": "https://example.com" },
                  "returnType": "boolean"
                }
              }
            },
            { "id": "txt1", "component": "Text", "text": "Go" }
          ]
        }
      }
    },
    {
      "description": "length: Invalid min type (string)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "length", "args": { "value": { "path": "/val" }, "min": "5" } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "length: Invalid max value (negative)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "length", "args": { "value": { "path": "/val" }, "max": -2 } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "numeric: Invalid min type (string)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "numeric", "args": { "value": { "path": "/val" }, "min": "10" } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "numeric: Invalid max type (string)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "numeric", "args": { "value": { "path": "/val" }, "max": "20" } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "regex: Invalid pattern type (number)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "regex", "args": { "value": { "path": "/val" }, "pattern": 123 } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "email: Invalid args count (too many)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [{ "condition": { "call": "email", "args": { "value": { "path": "/val" }, "extra": "foo" } }, "message": "Msg" }]
            }
          ]
        }
      }
    },
    {
      "description": "formatString: Invalid format string type (number)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatString",
                "args": { "value": 123 },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatNumber: Invalid precision type (boolean)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatNumber",
                "args": { "value": 123.456, "decimals": true },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatCurrency: Invalid currency code type (number)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatCurrency",
                "args": { "value": 123.45, "currency": 840 },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "formatDate: Invalid pattern type (null)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "txt1",
              "component": "Text",
              "text": {
                "call": "formatDate",
                "args": { "value": "2023-01-01", "format": null },
                "returnType": "string"
              }
            }
          ]
        }
      }
    },
    {
      "description": "openUrl: Invalid URL format (not a URI)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "btn1",
              "component": "Button",
              "child": "txt1",
              "action": {
                "functionCall": {
                  "call": "openUrl",
                  "args": { "url": "not a uri" },
                  "returnType": "void"
                }
              }
            },
            { "id": "txt1", "component": "Text", "text": "Go" }
          ]
        }
      }
    },
    {
      "description": "and: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "and",
                    "args": {
                      "values": [true, false]
                    },
                    "returnType": "boolean"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "and: Invalid (single value)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "and",
                    "args": { "values": [true] }
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "or: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "or",
                    "args": {
                      "values": [true, false]
                    },
                    "returnType": "boolean"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "or: Invalid (single value)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "or",
                    "args": { "values": [true] }
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "not: Valid call",
      "valid": true,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "not",
                    "args": {
                      "value": true
                    },
                    "returnType": "boolean"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "not: Invalid argument type (string)",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "not",
                    "args": { "value": "true" },
                    "returnType": "boolean"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "not: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "not",
                    "args": { "value": true },
                    "returnType": "string"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "required: Too many arguments",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "required",
                    "args": { "value": { "path": "/val" }, "extra": 1 },
                    "returnType": "boolean"
                  },
                  "message": "Required"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "regex: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "regex",
                    "args": { "value": { "path": "/val" }, "pattern": "^abc$" },
                    "returnType": "string"
                  },
                  "message": "Match"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "description": "and: Invalid returnType",
      "valid": false,
      "data": {
        "version": "v0.9",
        "updateComponents": {
          "surfaceId": "test",
          "components": [
            {
              "id": "tf1",
              "component": "TextField",
              "label": "L",
              "value": "",
              "checks": [
                {
                  "condition": {
                    "call": "and",
                    "args": { "values": [true, false] },
                    "returnType": "string"
                  },
                  "message": "Msg"
                }
              ]
            }
          ]
        }
      }
    }
  ]
}
